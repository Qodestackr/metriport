{
    "widgets": [
        {
            "height": 8,
            "width": 10,
            "y": 8,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIInfrastructureStack-APIFargateService785A4622-fkussZts8xsF", "ClusterName", "APIInfrastructureStack-APICluster381F6E68-v0y03IsPXhdE", { "color": "#1f77b4", "region": "us-west-1", "label": "CPU max - old" } ],
                    [ "...", { "stat": "Average", "region": "us-west-1", "color": "#aec7e8", "label": "CPU avg - old" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "yAxis": "right", "color": "#2ca02c", "region": "us-west-1", "label": "MEM max - old" } ],
                    [ "...", { "yAxis": "right", "stat": "Average", "region": "us-west-1", "color": "#98df8a", "label": "MEM avg - old" } ],
                    [ ".", "CPUUtilization", ".", "APIInfrastructureStack-APIFargateServiceAlbService1982B8ED-lHbszm7GZIg5", ".", ".", { "color": "#1f77b4", "region": "us-west-1", "label": "CPU max - new" } ],
                    [ "...", { "stat": "Average", "region": "us-west-1", "color": "#aec7e8", "label": "CPU avg - new" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "yAxis": "right", "color": "#2ca02c", "region": "us-west-1", "label": "MEM max - new" } ],
                    [ "...", { "yAxis": "right", "stat": "Average", "region": "us-west-1", "color": "#98df8a", "label": "MEM avg - new" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "API Server",
                "period": 300,
                "stat": "Maximum"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 136,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIServiceInfrastructureStack-APIServiceFargateServiceB310B9BA-UVQnWS50I0Bk", "ClusterName", "APIServiceInfrastructureStack-APIServiceCluster4614AF9B-RH7YLj5zWBvG", { "color": "#1f77b4", "region": "us-west-1" } ],
                    [ "...", { "stat": "Average", "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "yAxis": "right", "color": "#2ca02c", "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "stat": "Average", "region": "us-west-1", "color": "#98df8a" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "API Internal",
                "stat": "Maximum",
                "period": 300
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 26,
            "x": 6,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "CPUUtilization", "DBClusterIdentifier", "api-cluster", { "yAxis": "left", "region": "us-west-1", "id": "m1", "stat": "Maximum" } ],
                    [ "...", { "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "FreeableMemory", ".", ".", { "yAxis": "right", "stat": "Maximum", "region": "us-west-1" } ],
                    [ "...", { "region": "us-west-1", "color": "#98df8a", "yAxis": "right" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "API DB - CPU/Memory",
                "annotations": {
                    "horizontal": [
                        {
                            "visible": false,
                            "label": "cpu alarm",
                            "value": 90
                        },
                        {
                            "visible": false,
                            "label": "mem alarm",
                            "value": 0.15,
                            "yAxis": "right"
                        }
                    ]
                },
                "liveData": false
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 155,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/Lambda", "Invocations", "FunctionName", "APIServiceGenerateKeyLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServicePostConfirmationLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServiceRevokeKeyLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServiceStripeLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", "CCDAOpenSearchLambda", { "region": "us-west-1" } ],
                    [ "...", "CdaToVisualizationLambda", { "region": "us-west-1" } ],
                    [ "...", "CommonWellDocContributionLambda", { "region": "us-west-1" } ],
                    [ "...", "CWEnhancedCoverageTriggerLambda", { "region": "us-west-1" } ],
                    [ "...", "DocumentDownloaderLambda", { "region": "us-west-1" } ],
                    [ "...", "DocumentUploaderLambda", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterLambda", { "region": "us-west-1" } ],
                    [ "...", "FHIRServerLambda", { "region": "us-west-1" } ],
                    [ "...", "FhirToMedicalRecordLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledAPIQuotaCheckerLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledDBMaintenanceLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledDocumentQueryCheckerLambda", { "region": "us-west-1" } ],
                    [ "...", "TokenAuthLambda", { "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Lambdas Invocations",
                "stat": "Sum",
                "period": 300
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 164,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/Lambda", "Errors", "FunctionName", "APIServiceGenerateKeyLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServicePostConfirmationLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServiceRevokeKeyLambda", { "region": "us-west-1" } ],
                    [ "...", "APIServiceStripeLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", "CCDAOpenSearchLambda", { "region": "us-west-1" } ],
                    [ "...", "CdaToVisualizationLambda", { "region": "us-west-1" } ],
                    [ "...", "CommonWellDocContributionLambda", { "region": "us-west-1" } ],
                    [ "...", "CWEnhancedCoverageTriggerLambda", { "region": "us-west-1" } ],
                    [ "...", "DocumentDownloaderLambda", { "region": "us-west-1" } ],
                    [ "...", "DocumentUploaderLambda", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterLambda", { "region": "us-west-1" } ],
                    [ "...", "FHIRServerLambda", { "region": "us-west-1" } ],
                    [ "...", "FhirToMedicalRecordLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledAPIQuotaCheckerLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledDBMaintenanceLambda", { "region": "us-west-1" } ],
                    [ "...", "ScheduledDocumentQueryCheckerLambda", { "region": "us-west-1" } ],
                    [ "...", "TokenAuthLambda", { "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Lambdas Errors",
                "stat": "Sum",
                "period": 300
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 173,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ApiGateway", "Count", "ApiName", "api", { "stat": "SampleCount", "region": "us-west-1" } ],
                    [ ".", "4XXError", ".", ".", { "region": "us-west-1", "yAxis": "right" } ],
                    [ ".", "5XXError", ".", ".", { "region": "us-west-1", "yAxis": "right", "color": "#d62728" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 300,
                "title": "API Gateway - Requests vs. Responses"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 82,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "FHIRServerStack-FHIRServerFargateService46BCF377-gXh9molzfoo4", "ClusterName", "FHIRServerStack-FHIRServerClusterC4EE8AC0-00Vo19v9bvc5", { "color": "#1f77b4", "region": "us-west-1" } ],
                    [ "...", { "stat": "Average", "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "yAxis": "right", "color": "#2ca02c", "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "stat": "Average", "region": "us-west-1", "color": "#98df8a" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "FHIR Server",
                "stat": "Maximum",
                "period": 300
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 136,
            "x": 14,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "CPUUtilization", "Role", "WRITER", "DBClusterIdentifier", "api-service-cluster", { "stat": "Maximum", "region": "us-west-1" } ],
                    [ "...", { "color": "#aec7e8", "region": "us-west-1" } ],
                    [ ".", "ReadLatency", ".", ".", ".", ".", { "yAxis": "right", "region": "us-west-1" } ],
                    [ ".", "WriteLatency", ".", ".", ".", ".", { "yAxis": "right", "region": "us-west-1" } ],
                    [ ".", "CommitLatency", ".", ".", ".", ".", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "Internal DB - RDS Writer instance"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 0,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Product\n",
                "background": "solid"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 116,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# OpenSearch\n",
                "background": "solid"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 80,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# FHIR Server\n",
                "background": "solid"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 90,
            "x": 14,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "CPUUtilization", "DBClusterIdentifier", "fhir-server", { "yAxis": "left", "region": "us-west-1", "id": "m1", "stat": "Maximum" } ],
                    [ "...", { "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "FreeableMemory", ".", ".", { "yAxis": "right", "stat": "Maximum", "region": "us-west-1" } ],
                    [ "...", { "region": "us-west-1", "color": "#98df8a", "yAxis": "right" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "FHIR DB - RDS"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 144,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Others\n",
                "background": "solid"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 34,
            "x": 6,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ReadLatency", "DBClusterIdentifier", "api-cluster", { "yAxis": "left", "region": "us-west-1" } ],
                    [ ".", "CommitLatency", ".", ".", { "yAxis": "right", "region": "us-west-1" } ],
                    [ ".", "WriteLatency", ".", ".", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "API DB - Latency",
                "liveData": false,
                "annotations": {
                    "horizontal": [
                        {
                            "color": "#1f77b4",
                            "label": "1 second",
                            "value": 1
                        },
                        {
                            "label": "1 second",
                            "value": 1,
                            "yAxis": "right"
                        }
                    ]
                }
            }
        },
        {
            "height": 8,
            "width": 8,
            "y": 26,
            "x": 16,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "VolumeReadIOPs", "DBClusterIdentifier", "api-cluster", { "id": "m2", "label": "VolumeReadIOPs", "region": "us-west-1" } ],
                    [ ".", "VolumeWriteIOPs", ".", ".", { "yAxis": "right", "id": "m1", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "API DB - IOPS",
                "liveData": false,
                "annotations": {
                    "horizontal": [
                        {
                            "label": "VolumeReadIOPs >= 1_200_000 for 1 datapoints within 5 minutes",
                            "value": 1200000
                        },
                        {
                            "label": "VolumeWriteIOPs >= 600_000 for 1 datapoints within 5 minutes",
                            "value": 600000,
                            "yAxis": "right"
                        }
                    ]
                },
                "yAxis": {
                    "right": {
                        "label": ""
                    },
                    "left": {
                        "label": ""
                    }
                }
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 106,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# FHIR Converter\n",
                "background": "solid"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 108,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIInfrastructureStack-FHIRConverterFargateService8CA04E0D-eZf2v9mn6vvJ", "ClusterName", "APIInfrastructureStack-FHIRConverterCluster3ED284AD-6lmkKWgYr3oi", { "color": "#1f77b4", "region": "us-west-1" } ],
                    [ "...", { "stat": "Average", "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "yAxis": "right", "color": "#2ca02c", "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "stat": "Average", "region": "us-west-1", "color": "#98df8a" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "FHIR Converter",
                "stat": "Maximum",
                "period": 300
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 90,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "VolumeReadIOPs", "DBClusterIdentifier", "fhir-server", { "region": "us-west-1", "id": "m1", "label": "VolumeReadIOPs-Billable" } ],
                    [ ".", "VolumeWriteIOPs", ".", ".", { "yAxis": "right", "region": "us-west-1", "id": "m2" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "FHIR DB - IOPS",
                "liveData": false,
                "annotations": {
                    "horizontal": [
                        {
                            "label": "VolumeWriteIOPs >= 300_000 for 1 datapoints within 5min",
                            "value": 800000,
                            "yAxis": "right"
                        },
                        {
                            "label": "VolumeReadIOPs >= 1_000_000 for 1 datapoints within 5min",
                            "value": 1000000
                        }
                    ]
                }
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 98,
            "x": 4,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ReadLatency", "DBClusterIdentifier", "fhir-server", { "yAxis": "left", "region": "us-west-1" } ],
                    [ "AWS/RDS", "CommitLatency", "DBClusterIdentifier", "fhir-server", { "yAxis": "right", "region": "us-west-1" } ],
                    [ "AWS/RDS", "WriteLatency", "DBClusterIdentifier", "fhir-server", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "FHIR DB - Latency",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 4,
            "y": 82,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "FHIRServerStack-FHIRServerFargateService46BCF377-gXh9molzfoo4", "ClusterName", "FHIRServerStack-FHIRServerClusterC4EE8AC0-00Vo19v9bvc5", { "color": "#1f77b4", "region": "us-west-1", "label": "Task count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Task Count",
                "stat": "SampleCount",
                "period": 60
            }
        },
        {
            "height": 8,
            "width": 4,
            "y": 136,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIServiceInfrastructureStack-APIServiceFargateServiceB310B9BA-UVQnWS50I0Bk", "ClusterName", "APIServiceInfrastructureStack-APIServiceCluster4614AF9B-RH7YLj5zWBvG", { "color": "#1f77b4", "region": "us-west-1", "label": "Task count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Task Count",
                "stat": "SampleCount",
                "period": 60
            }
        },
        {
            "height": 8,
            "width": 4,
            "y": 8,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIInfrastructureStack-APIFargateService785A4622-fkussZts8xsF", "ClusterName", "APIInfrastructureStack-APICluster381F6E68-v0y03IsPXhdE", { "color": "#1f77b4", "region": "us-west-1", "label": "Task count" } ],
                    [ "...", "APIInfrastructureStack-APIFargateServiceAlbService1982B8ED-lHbszm7GZIg5", ".", ".", { "color": "#1f77b4", "region": "us-west-1", "label": "Task count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Task Count",
                "stat": "SampleCount",
                "period": 60
            }
        },
        {
            "height": 8,
            "width": 4,
            "y": 90,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ACUUtilization", "DBClusterIdentifier", "fhir-server", { "yAxis": "left", "region": "us-west-1", "color": "#d62728" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "DB - ACU Utilization",
                "liveData": false,
                "annotations": {
                    "horizontal": [
                        {
                            "label": "ACU Utilization >= 80%",
                            "value": 80
                        }
                    ]
                }
            }
        },
        {
            "height": 8,
            "width": 6,
            "y": 26,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ACUUtilization", "DBClusterIdentifier", "api-cluster", { "yAxis": "left", "region": "us-west-1", "color": "#d62728" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "API DB - ACU Utilization",
                "liveData": false,
                "annotations": {
                    "horizontal": [
                        {
                            "label": "ACU Utilization >= 80%",
                            "value": 80
                        }
                    ]
                }
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 108,
            "x": 14,
            "type": "log",
            "properties": {
                "query": "SOURCE '/aws/ecs/containerinsights/APIInfrastructureStack-FHIRConverterCluster3ED284AD-6lmkKWgYr3oi/performance' | fields\n\n  CpuUtilized / CpuReserved * 100 as CpuUtilizationPercentage,\n\n  MemoryUtilized / MemoryReserved * 100 as MemoryUtilizationPercentage\n\n| filter Type=\"Task\"\n| stats avg(CpuUtilizationPercentage) as CpuAvgPct, avg(MemoryUtilizationPercentage) as MemAvgPct, @timestamp by TaskId, bin(1m) as When\n| sort When desc, TaskId\n| display CpuAvgPct, MemAvgPct, When, TaskId\n",
                "region": "us-west-1",
                "stacked": false,
                "title": "containerinsights/FHIRConverterCluster",
                "view": "table"
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 82,
            "x": 14,
            "type": "log",
            "properties": {
                "query": "SOURCE '/aws/ecs/containerinsights/FHIRServerStack-FHIRServerClusterC4EE8AC0-00Vo19v9bvc5/performance' | fields\n\n\n\n  CpuUtilized / CpuReserved * 100 as CpuUtilizationPercentage,\n\n\n\n  MemoryUtilized / MemoryReserved * 100 as MemoryUtilizationPercentage\n\n\n\n| filter Type=\"Task\"\n| stats avg(CpuUtilizationPercentage) as CpuAvgPct, avg(MemoryUtilizationPercentage) as MemAvgPct, @timestamp by TaskId, bin(1m) as When\n| sort When desc, TaskId\n| display CpuAvgPct, MemAvgPct, When, TaskId\n\n\n\n\n#fields\n#  CpuUtilized / CpuReserved * 100 as CpuUtilizationPercentage,\n#  MemoryUtilized / MemoryReserved * 100 as MemoryUtilizationPercentage\n#| filter Type=\"Task\"\n#| stats avg(CpuUtilizationPercentage) as CpuAvgPct, avg(MemoryUtilizationPercentage) as MemAvgPct by TaskId\n",
                "region": "us-west-1",
                "stacked": false,
                "title": "containerinsights/FHIRServerCluster",
                "view": "table"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 146,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/SQS", "NumberOfMessagesReceived", "QueueName", "FHIRConverterQueue", { "region": "us-west-1" } ],
                    [ "...", "FHIRServerDLQ", { "yAxis": "right", "region": "us-west-1" } ],
                    [ "...", "FHIRServerQueue", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterDLQ", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "title": "FHIR Queues - Messages Received"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 164,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "Metriport", "Memory total", "Service", "FHIRServerLambda", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterLambda", { "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Lambdas memory",
                "stat": "Maximum",
                "period": 300,
                "yAxis": {
                    "left": {
                        "showUnits": false,
                        "label": "Memory (MB)"
                    }
                }
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 155,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/Lambda", "Duration", "FunctionName", "APIServiceGenerateKeyLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "APIServicePostConfirmationLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "APIServiceRevokeKeyLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "APIServiceStripeLambdaLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "CdaToVisualizationLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "FHIRConverterLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "FHIRServerLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ],
                    [ "...", "TokenAuthLambda", { "region": "us-west-1" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "stat": "Maximum" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Lambdas Duration",
                "stat": "Average",
                "period": 300,
                "yAxis": {
                    "left": {
                        "label": "millis",
                        "showUnits": false
                    },
                    "right": {
                        "label": "millis",
                        "showUnits": false
                    }
                }
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 98,
            "x": 14,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "DatabaseConnections", "DBClusterIdentifier", "fhir-server" ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "title": "FHIR DB - Connections",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 8,
            "y": 16,
            "x": 16,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "Metriport", "API Success", { "label": "2xx", "region": "us-west-1" } ],
                    [ ".", "API Failures", { "label": "3xx | 4xx | 5xx", "region": "us-west-1" } ],
                    [ "AWS/ApplicationELB", "TargetResponseTime", "LoadBalancer", "app/APIIn-FHIRC-1V37740IU38KW/f208b7a1d98ccc2e", { "yAxis": "right", "stat": "Maximum", "region": "us-west-1", "label": "Response time - NLB" } ],
                    [ "...", "app/APIInf-APIFa-Ad0ZjbBOQg4I/90128f3f5a57e5a7", { "label": "Response time - ALB", "region": "us-west-1", "yAxis": "right", "color": "#2ca02c" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 300,
                "title": "API Responses (API GW at the bottom)"
            }
        },
        {
            "height": 8,
            "width": 8,
            "y": 34,
            "x": 16,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "DatabaseConnections", "DBClusterIdentifier", "api-cluster" ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "title": "API DB - Connections",
                "liveData": false
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 146,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/SQS", "ApproximateNumberOfMessagesVisible", "QueueName", "CCDAOpenSearchDLQ", { "region": "us-west-1" } ],
                    [ "...", "CCDAOpenSearchQueue", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterDLQ", { "region": "us-west-1" } ],
                    [ "...", "FHIRConverterQueue", { "region": "us-west-1" } ],
                    [ "...", "FHIRServerDLQ", { "region": "us-west-1" } ],
                    [ "...", "FHIRServerQueue", { "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "SQS Messages Visible"
            }
        },
        {
            "height": 8,
            "width": 7,
            "y": 126,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "SearchableDocuments", "DomainName", "ccdaopensearch-domain", "ClientId", "463519787594", { "yAxis": "left" } ],
                    [ ".", "FreeStorageSpace", ".", ".", ".", ".", { "yAxis": "right", "stat": "Minimum" } ],
                    [ "...", { "yAxis": "right", "stat": "Maximum" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "title": "OpenSearch - Storage",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 7,
            "y": 118,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "CPUUtilization", "DomainName", "ccdaopensearch-domain", "ClientId", "463519787594", { "label": "Nodes CPU", "region": "us-west-1" } ],
                    [ ".", "MasterCPUUtilization", ".", ".", ".", ".", { "label": "Master CPU", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "OpenSearch - CPU",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 7,
            "y": 118,
            "x": 7,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "JVMMemoryPressure", "DomainName", "ccdaopensearch-domain", "ClientId", "463519787594", { "yAxis": "left", "region": "us-west-1", "label": "Nodes JVMMemoryPressure" } ],
                    [ ".", "MasterJVMMemoryPressure", ".", ".", ".", ".", { "yAxis": "left", "region": "us-west-1", "label": "Master JVMMemoryPressure" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "OpenSearch - Memory",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 7,
            "y": 126,
            "x": 7,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "SearchLatency", "DomainName", "ccdaopensearch-domain", "ClientId", "463519787594" ],
                    [ ".", "ReadLatency", ".", ".", ".", "." ],
                    [ ".", "IndexingLatency", ".", ".", ".", "." ],
                    [ ".", "WriteLatency", ".", ".", ".", "." ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "title": "OpenSearch - Latency",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 7,
            "y": 118,
            "x": 14,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "2xx", "DomainName", "ccdaopensearch-domain", "ClientId", "463519787594", { "region": "us-west-1" } ],
                    [ ".", "5xx", ".", ".", ".", ".", { "region": "us-west-1" } ],
                    [ ".", "3xx", ".", ".", ".", ".", { "region": "us-west-1" } ],
                    [ ".", "SearchRate", ".", ".", ".", ".", { "region": "us-west-1", "yAxis": "right" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "title": "OpenSearch - Searches",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 10,
            "y": 8,
            "x": 14,
            "type": "log",
            "properties": {
                "query": "SOURCE '/aws/ecs/containerinsights/APIInfrastructureStack-APICluster381F6E68-v0y03IsPXhdE/performance' | stats avg(MemoryUtilized) by bin (1m) as period, TaskId\n| filter Type = \"Task\" | sort period desc, TaskId |  limit 10",
                "region": "us-west-1",
                "title": "API Server - Memory by TaskId",
                "view": "table"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 173,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ApiGateway", "Count", "ApiName", "api", { "stat": "SampleCount", "region": "us-west-1" } ],
                    [ ".", "Latency", ".", ".", { "yAxis": "right", "region": "us-west-1", "label": "Latency - Avg", "stat": "Average" } ],
                    [ "...", { "yAxis": "right", "region": "us-west-1", "color": "#2ca02c", "label": "Latency - P99" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "p99",
                "period": 300,
                "title": "API Gateway Requests vs. Latency"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 134,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Internal/Admin\n",
                "background": "solid"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 24,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# OSS DB\n",
                "background": "solid"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 58,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# IHE GW Outbound"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 60,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "IHEStack-IHEGatewayOutboundFargateService64CBCB18-OCyZXHesF0c8", "ClusterName", "IHEStack-IHEGatewayClusterA7D9B464-kDzPwrYyASiJ", { "label": "CPUUtilization Maximum", "region": "us-west-1" } ],
                    [ "...", { "label": "CPUUtilization Avg", "stat": "Average", "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "label": "MemoryUtilization Maximum", "yAxis": "right", "region": "us-west-1" } ],
                    [ "...", { "label": "MemoryUtilization Avg", "stat": "Average", "yAxis": "right", "region": "us-west-1", "color": "#98df8a" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "CPUUtilization, MemoryUtilization"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 60,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "IHEStack-IHEGatewayOutboundFargateService64CBCB18-OCyZXHesF0c8", "ClusterName", "IHEStack-IHEGatewayClusterA7D9B464-kDzPwrYyASiJ", { "region": "us-west-1", "label": "Task Count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "period": 60,
                "stat": "SampleCount",
                "title": "Task Count"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 69,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# IHE GW Inbound"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 71,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "IHEStack-IHEGatewayInboundFargateService4393BE41-f5Zwiiul8LIo", "ClusterName", "IHEStack-IHEGatewayClusterA7D9B464-kDzPwrYyASiJ", { "label": "CPUUtilization Maximum", "region": "us-west-1" } ],
                    [ "...", { "stat": "Average", "label": "CPUUtilization Avg", "region": "us-west-1", "color": "#aec7e8" } ],
                    [ ".", "MemoryUtilization", ".", ".", ".", ".", { "label": "MemoryUtilization Maximum", "region": "us-west-1", "yAxis": "right" } ],
                    [ "...", { "label": "MemoryUtilization Avg", "stat": "Average", "region": "us-west-1", "color": "#98df8a", "yAxis": "right" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 300,
                "title": "CPUUtilization, MemoryUtilization"
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 71,
            "x": 12,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "IHEStack-IHEGatewayInboundFargateService4393BE41-f5Zwiiul8LIo", "ClusterName", "IHEStack-IHEGatewayClusterA7D9B464-kDzPwrYyASiJ", { "region": "us-west-1", "label": "Task count" } ]
                ],
                "sparkline": true,
                "view": "timeSeries",
                "region": "us-west-1",
                "period": 60,
                "stat": "SampleCount",
                "stacked": false,
                "title": "Task Count"
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 51,
            "x": 0,
            "type": "log",
            "properties": {
                "query": "SOURCE '/aws/ecs/containerinsights/IHEStack-IHEGatewayClusterA7D9B464-kDzPwrYyASiJ/performance' | stats avg(MemoryUtilized) by bin (1m) as period, TaskId\n| filter Type = \"Task\" | sort period desc, TaskId |  limit 10",
                "region": "us-west-1",
                "stacked": false,
                "title": "IHE GW Cluster - Memory by TaskId",
                "view": "table"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 42,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# IHE GW"
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 44,
            "x": 8,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ACUUtilization", "DBClusterIdentifier", "ihe-db", { "stat": "Average", "region": "us-west-1", "color": "#d62728" } ]
                ],
                "title": "IHE GW DB - ACU Utilization",
                "annotations": {
                    "horizontal": [
                        {
                            "label": "ACUUtilization >= 80 for 1 datapoints within 5 minutes",
                            "value": 80
                        }
                    ]
                },
                "view": "timeSeries",
                "stacked": false,
                "period": 300,
                "region": "us-west-1"
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 44,
            "x": 16,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "VolumeReadIOPs", "DBClusterIdentifier", "ihe-db", { "stat": "Average", "region": "us-west-1" } ],
                    [ ".", "VolumeWriteIOPs", ".", ".", { "stat": "Average", "region": "us-west-1", "yAxis": "right" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "period": 300,
                "region": "us-west-1",
                "title": "IHE GW DB - IOPS",
                "annotations": {
                    "horizontal": [
                        {
                            "label": "VolumeReadIOPs >= 1,800,000 for 1 dpts / 5 minutes",
                            "value": 1800000
                        },
                        {
                            "label": "VolumeWriteIOPs >= 1,800,000 for 1 dpts / 5 minutes",
                            "value": 1800000,
                            "yAxis": "right"
                        }
                    ]
                }
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 44,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "CPUUtilization", "DBClusterIdentifier", "ihe-db", { "region": "us-west-1", "label": "CPUUtilization Maximum", "stat": "Maximum" } ],
                    [ "...", { "region": "us-west-1", "label": "CPUUtilization Avg", "color": "#aec7e8" } ],
                    [ ".", "FreeableMemory", ".", ".", { "region": "us-west-1", "label": "FreeableMemory Maximum", "stat": "Maximum", "yAxis": "right" } ],
                    [ "...", { "region": "us-west-1", "label": "FreeableMemory Avg", "yAxis": "right", "color": "#98df8a" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "period": 300,
                "stat": "Average",
                "title": "IHE GW DB - CPU/Mem"
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 51,
            "x": 8,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ReadLatency", "DBClusterIdentifier", "ihe-db", { "yAxis": "left", "region": "us-west-1" } ],
                    [ ".", "CommitLatency", ".", ".", { "yAxis": "right", "region": "us-west-1" } ],
                    [ ".", "WriteLatency", ".", ".", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "IHE GW DB - Latency",
                "annotations": {
                    "horizontal": [
                        {
                            "color": "#1f77b4",
                            "label": "1 second",
                            "value": 1
                        },
                        {
                            "label": "1 second",
                            "value": 1,
                            "yAxis": "right"
                        }
                    ]
                }
            }
        },
        {
            "height": 7,
            "width": 8,
            "y": 51,
            "x": 16,
            "type": "metric",
            "properties": {
                "view": "timeSeries",
                "stacked": false,
                "metrics": [
                    [ "AWS/RDS", "DatabaseConnections", "DBClusterIdentifier", "ihe-db", { "period": 60 } ]
                ],
                "region": "us-west-1",
                "title": "IHE GW DB -Connections"
            }
        },
        {
            "height": 2,
            "width": 24,
            "y": 6,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# OSS API\n",
                "background": "solid"
            }
        },
        {
            "height": 4,
            "width": 6,
            "y": 2,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/Lambda", "Duration", "FunctionName", "FhirToMedicalRecordLambda", { "region": "us-west-1", "stat": "Average", "label": "Duration Average" } ],
                    [ "...", { "region": "us-west-1", "label": "Duration p99" } ]
                ],
                "sparkline": false,
                "view": "singleValue",
                "region": "us-west-1",
                "stat": "p99",
                "period": 300,
                "title": "MR generation",
                "start": "-PT168H",
                "end": "P0D",
                "setPeriodToTimeRange": true,
                "trend": false
            }
        },
        {
            "height": 4,
            "width": 4,
            "y": 2,
            "x": 6,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/Lambda", "Duration", "FunctionName", "FHIRConverterLambda", { "region": "us-west-1" } ]
                ],
                "sparkline": false,
                "view": "singleValue",
                "region": "us-west-1",
                "stat": "p99",
                "period": 300,
                "title": "FHIR Conversion",
                "start": "-PT168H",
                "end": "P0D"
            }
        },
        {
            "height": 8,
            "width": 6,
            "y": 34,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/RDS", "ACUUtilization", "Role", "READER", "DBClusterIdentifier", "api-cluster", { "region": "us-west-1" } ],
                    [ "...", "WRITER", ".", ".", { "yAxis": "right", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "title": "API DB - ACU reader/writer",
                "liveData": false
            }
        },
        {
            "height": 8,
            "width": 4,
            "y": 108,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "APIInfrastructureStack-FHIRConverterFargateService8CA04E0D-eZf2v9mn6vvJ", "ClusterName", "APIInfrastructureStack-FHIRConverterCluster3ED284AD-6lmkKWgYr3oi", { "color": "#1f77b4", "region": "us-west-1", "label": "Task count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "title": "Task Count",
                "stat": "SampleCount",
                "period": 60
            }
        },
        {
            "height": 8,
            "width": 8,
            "y": 16,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ApplicationELB", "HTTPCode_Target_2XX_Count", "LoadBalancer", "app/APIInf-APIFa-Ad0ZjbBOQg4I/90128f3f5a57e5a7", { "region": "us-west-1", "label": "2XX_Count" } ],
                    [ ".", "HTTPCode_Target_4XX_Count", ".", ".", { "yAxis": "right", "region": "us-west-1", "label": "4XX_Count" } ],
                    [ ".", "HTTPCode_Target_5XX_Count", ".", ".", { "yAxis": "right", "region": "us-west-1", "label": "5XX_Count" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 300,
                "title": "(new) API Responses (API GW at the bottom)"
            }
        },
        {
            "height": 8,
            "width": 8,
            "y": 16,
            "x": 8,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ApplicationELB", "HTTPCode_ELB_504_Count", "LoadBalancer", "app/APIInf-APIFa-Ad0ZjbBOQg4I/90128f3f5a57e5a7", { "yAxis": "right" } ],
                    [ ".", "HTTPCode_ELB_502_Count", ".", ".", { "yAxis": "right" } ],
                    [ ".", "HTTPCode_ELB_5XX_Count", ".", ".", { "yAxis": "right" } ],
                    [ ".", "HTTPCode_ELB_4XX_Count", ".", "." ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 300,
                "title": "ALB responses"
            }
        }
    ]
}